{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "makadfwestus2"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/DedupeFuzzyFlowlet1')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "Flowlet",
				"typeProperties": {
					"sources": [],
					"sinks": [],
					"transformations": [
						{
							"name": "FuzzyMatch"
						},
						{
							"name": "groupSoundex"
						},
						{
							"name": "Orig1"
						},
						{
							"name": "soundexJoin"
						},
						{
							"name": "soundexBranch"
						},
						{
							"name": "groupPhone"
						},
						{
							"name": "phoneBranch"
						},
						{
							"name": "phoneJoin"
						},
						{
							"name": "groupZip"
						},
						{
							"name": "zipBranch"
						},
						{
							"name": "zipJoin"
						},
						{
							"name": "setConstants"
						},
						{
							"name": "matchScore"
						},
						{
							"name": "finalResult"
						},
						{
							"name": "MapNames"
						},
						{
							"name": "CreateFullName"
						},
						{
							"name": "CheckForDupes"
						},
						{
							"name": "inputName"
						},
						{
							"name": "outputDupes"
						},
						{
							"name": "outputNoDupes"
						}
					],
					"scriptLines": [
						"input(output(",
						"          {Emp ID} as string,",
						"          {Middle Initial} as string,",
						"          {Last Name} as string,",
						"          {Phone No. } as string,",
						"          Zip as string,",
						"          {First Name} as string",
						"     ),",
						"     order: 0,",
						"     allowSchemaDrift: true) ~> inputName",
						"MapNames derive(SoundexValue = soundex(fullname)) ~> FuzzyMatch",
						"Orig1 aggregate(groupBy(SoundexValue),",
						"     soundexmatch = sum(1)) ~> groupSoundex",
						"FuzzyMatch select(mapColumn(",
						"          acctnum,",
						"          fullname,",
						"          phone,",
						"          zip,",
						"          SoundexValue",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> Orig1",
						"groupSoundex, soundexBranch join(groupSoundex@SoundexValue == soundexBranch@SoundexValue,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> soundexJoin",
						"FuzzyMatch select(mapColumn(",
						"          acctnum,",
						"          fullname,",
						"          phone,",
						"          zip,",
						"          SoundexValue",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> soundexBranch",
						"soundexJoin aggregate(groupBy(phone,",
						"          soundexBranch@SoundexValue),",
						"     phonematch = sum(1),",
						"          acctnum_agg = last(acctnum)) ~> groupPhone",
						"soundexJoin select(mapColumn(",
						"          soundexmatch,",
						"          acctnum,",
						"          fullname,",
						"          phone,",
						"          zip,",
						"          SoundexValue = soundexBranch@SoundexValue",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> phoneBranch",
						"groupPhone, phoneBranch join(acctnum_agg == acctnum,",
						"     joinType:'right',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> phoneJoin",
						"phoneJoin aggregate(groupBy(zip,",
						"          phoneBranch@SoundexValue),",
						"     zipcount = sum(1),",
						"          acctnum_agg = last(acctnum_agg)) ~> groupZip",
						"phoneJoin select(mapColumn(",
						"          phonematch,",
						"          soundexmatch,",
						"          acctnum,",
						"          fullname,",
						"          phone = phoneBranch@phone,",
						"          zip,",
						"          SoundexValue = phoneBranch@SoundexValue",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> zipBranch",
						"groupZip, zipBranch join(acctnum_agg == acctnum,",
						"     joinType:'right',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> zipJoin",
						"zipJoin derive(soundexweight = 50,",
						"          zipweight = 25,",
						"          phoneweight = 25,",
						"          soundexbool = iif (soundexmatch > 1, 1, 0),",
						"          zipbool = iif (zipcount > 1, 1, 0),",
						"          phonebool = iif (phonematch > 1, 1, 0)) ~> setConstants",
						"setConstants derive(matchscore = (soundexbool * 50) + (zipbool * 25) + (phonebool * 25)) ~> matchScore",
						"matchScore select(mapColumn(",
						"          phone,",
						"          acctnum,",
						"          fullname,",
						"          zip = zipBranch@zip,",
						"          matchscore",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> finalResult",
						"CreateFullName select(mapColumn(",
						"          phone = {Phone No. },",
						"          zip = Zip,",
						"          fullname,",
						"          acctnum = {Emp ID}",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> MapNames",
						"inputName derive(fullname = {First Name} + ' ' + {Last Name}) ~> CreateFullName",
						"finalResult split(matchscore > 50,",
						"     disjoint: false) ~> CheckForDupes@(Duplicates, NotDupe)",
						"CheckForDupes@Duplicates output(mapColumn(",
						"          each(match(/* All input columns */true()),",
						"               /* Input name */$$ = $$)",
						"     )) ~> outputDupes",
						"CheckForDupes@NotDupe output() ~> outputNoDupes"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/DedupeFuzzyFlowlet2')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "Flowlet",
				"typeProperties": {
					"sources": [],
					"sinks": [],
					"transformations": [
						{
							"name": "FuzzyMatch"
						},
						{
							"name": "groupSoundex"
						},
						{
							"name": "Orig1"
						},
						{
							"name": "soundexJoin"
						},
						{
							"name": "soundexBranch"
						},
						{
							"name": "groupPhone"
						},
						{
							"name": "phoneBranch"
						},
						{
							"name": "phoneJoin"
						},
						{
							"name": "groupZip"
						},
						{
							"name": "zipBranch"
						},
						{
							"name": "zipJoin"
						},
						{
							"name": "setConstants"
						},
						{
							"name": "matchScore"
						},
						{
							"name": "finalResult"
						},
						{
							"name": "MapNames"
						},
						{
							"name": "CreateFullName"
						},
						{
							"name": "CheckForDupes"
						},
						{
							"name": "inputName"
						},
						{
							"name": "outputDupes"
						},
						{
							"name": "outputNoDupes"
						}
					],
					"scriptLines": [
						"input(output(",
						"          {Emp ID} as string,",
						"          {First Name} as string,",
						"          {Middle Initial} as string,",
						"          {Last Name} as string,",
						"          {Phone No. } as string,",
						"          Zip as string",
						"     ),",
						"     order: 0,",
						"     allowSchemaDrift: true) ~> inputName",
						"MapNames derive(SoundexValue = soundex(fullname)) ~> FuzzyMatch",
						"Orig1 aggregate(groupBy(SoundexValue),",
						"     soundexmatch = sum(1)) ~> groupSoundex",
						"FuzzyMatch select(mapColumn(",
						"          acctnum,",
						"          fullname,",
						"          phone,",
						"          zip,",
						"          SoundexValue",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> Orig1",
						"groupSoundex, soundexBranch join(groupSoundex@SoundexValue == soundexBranch@SoundexValue,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> soundexJoin",
						"FuzzyMatch select(mapColumn(",
						"          acctnum,",
						"          fullname,",
						"          phone,",
						"          zip,",
						"          SoundexValue",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> soundexBranch",
						"soundexJoin aggregate(groupBy(phone,",
						"          soundexBranch@SoundexValue),",
						"     phonematch = sum(1),",
						"          acctnum_agg = last(acctnum)) ~> groupPhone",
						"soundexJoin select(mapColumn(",
						"          soundexmatch,",
						"          acctnum,",
						"          fullname,",
						"          phone,",
						"          zip,",
						"          SoundexValue = soundexBranch@SoundexValue",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> phoneBranch",
						"groupPhone, phoneBranch join(acctnum_agg == acctnum,",
						"     joinType:'right',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> phoneJoin",
						"phoneJoin aggregate(groupBy(zip,",
						"          phoneBranch@SoundexValue),",
						"     zipcount = sum(1),",
						"          acctnum_agg = last(acctnum_agg)) ~> groupZip",
						"phoneJoin select(mapColumn(",
						"          phonematch,",
						"          soundexmatch,",
						"          acctnum,",
						"          fullname,",
						"          phone = phoneBranch@phone,",
						"          zip,",
						"          SoundexValue = phoneBranch@SoundexValue",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> zipBranch",
						"groupZip, zipBranch join(acctnum_agg == acctnum,",
						"     joinType:'right',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> zipJoin",
						"zipJoin derive(soundexweight = 50,",
						"          zipweight = 25,",
						"          phoneweight = 25,",
						"          soundexbool = iif (soundexmatch > 1, 1, 0),",
						"          zipbool = iif (zipcount > 1, 1, 0),",
						"          phonebool = iif (phonematch > 1, 1, 0)) ~> setConstants",
						"setConstants derive(matchscore = (soundexbool * 50) + (zipbool * 25) + (phonebool * 25)) ~> matchScore",
						"matchScore select(mapColumn(",
						"          phone,",
						"          acctnum,",
						"          fullname,",
						"          zip = zipBranch@zip,",
						"          matchscore",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> finalResult",
						"CreateFullName select(mapColumn(",
						"          phone = {Phone No. },",
						"          zip = Zip,",
						"          fullname,",
						"          acctnum = {Emp ID}",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> MapNames",
						"inputName derive(fullname = {First Name} + ' ' + {Last Name}) ~> CreateFullName",
						"finalResult split(matchscore > 50,",
						"     disjoint: false) ~> CheckForDupes@(Duplicates, NotDupe)",
						"CheckForDupes@Duplicates output(mapColumn(",
						"          each(match(/* All input columns */true()),",
						"               /* Input name */$$ = $$)",
						"     )) ~> outputDupes",
						"CheckForDupes@NotDupe output() ~> outputNoDupes"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Increase Prices and Check')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "Flowlet",
				"typeProperties": {
					"sources": [],
					"sinks": [],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "assert1"
						},
						{
							"name": "input1"
						},
						{
							"name": "output1"
						}
					],
					"scriptLines": [
						"input(output(",
						"          ProductID as integer,",
						"          Name as string,",
						"          ProductNumber as string,",
						"          Color as string,",
						"          StandardCost as decimal(19,4),",
						"          ListPrice as decimal(19,4),",
						"          EffectiveDate as timestamp,",
						"          Active as integer",
						"     ),",
						"     order: 0,",
						"     allowSchemaDrift: true) ~> input1",
						"input1 derive(ListPrice = ListPrice * 1.2) ~> derivedColumn1",
						"derivedColumn1 assert(expectTrue(Color != 'Multi', false, 'noMultiColor', null, \"This is a bad row because ${Color} is incorrect\")) ~> assert1",
						"assert1 output() ~> output1"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/MarksFuncs')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "These are my custom functions",
				"type": "UDFLibrary",
				"typeProperties": {
					"sources": [],
					"sinks": [],
					"transformations": [],
					"scriptLines": [
						"isProfitable(integer, integer) as boolean = ((i1 - i2) / i1) > .50,",
						"toEpoch(timestamp) as long = toLong( i1-toTimestamp('1970-01-01 00:00:00.000', 'yyyy-MM-dd HH:mm:ss.SSS')) /1000l"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/dataDedupeFlowlet')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "Flowlet",
				"typeProperties": {
					"sources": [],
					"sinks": [],
					"transformations": [
						{
							"name": "FuzzyMatch"
						},
						{
							"name": "groupSoundex"
						},
						{
							"name": "Orig1"
						},
						{
							"name": "soundexJoin"
						},
						{
							"name": "soundexBranch"
						},
						{
							"name": "groupPhone"
						},
						{
							"name": "phoneBranch"
						},
						{
							"name": "phoneJoin"
						},
						{
							"name": "groupZip"
						},
						{
							"name": "zipBranch"
						},
						{
							"name": "zipJoin"
						},
						{
							"name": "setConstants"
						},
						{
							"name": "matchScore"
						},
						{
							"name": "finalResult"
						},
						{
							"name": "MapNames"
						},
						{
							"name": "CreateFullName"
						},
						{
							"name": "CheckForDupes"
						},
						{
							"name": "inputName"
						},
						{
							"name": "outputDupes"
						},
						{
							"name": "outputNoDupes"
						}
					],
					"scriptLines": [
						"input(output(",
						"          {Emp ID} as string,",
						"          {Name Prefix} as string,",
						"          {First Name} as string,",
						"          {Middle Initial} as string,",
						"          {Last Name} as string,",
						"          Gender as string,",
						"          {E Mail} as string,",
						"          {Father's Name} as string,",
						"          {Mother's Name} as string,",
						"          {Mother's Maiden Name} as string,",
						"          {Date of Birth} as string,",
						"          {Time of Birth} as string,",
						"          {Age in Yrs.} as double '##.##',",
						"          {Weight in Kgs.} as string,",
						"          {Date of Joining} as string,",
						"          {Quarter of Joining} as string,",
						"          {Half of Joining} as string,",
						"          {Year of Joining} as string,",
						"          {Month of Joining} as string,",
						"          {Month Name of Joining} as string,",
						"          {Short Month} as string,",
						"          {Day of Joining} as string,",
						"          {DOW of Joining} as string,",
						"          {Short DOW} as string,",
						"          {Age in Company (Years)} as string,",
						"          Salary as integer,",
						"          {Last % Hike} as string,",
						"          SSN as string,",
						"          {Phone No. } as string,",
						"          {Place Name} as string,",
						"          County as string,",
						"          City as string,",
						"          State as string,",
						"          Zip as string,",
						"          Region as string,",
						"          {User Name} as string,",
						"          Password as string",
						"     ),",
						"     order: 0,",
						"     allowSchemaDrift: true) ~> inputName",
						"MapNames derive(SoundexValue = soundex(fullname)) ~> FuzzyMatch",
						"Orig1 aggregate(groupBy(SoundexValue),",
						"     soundexmatch = sum(1)) ~> groupSoundex",
						"FuzzyMatch select(mapColumn(",
						"          acctnum,",
						"          fullname,",
						"          phone,",
						"          zip,",
						"          SoundexValue",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> Orig1",
						"groupSoundex, soundexBranch join(groupSoundex@SoundexValue == soundexBranch@SoundexValue,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> soundexJoin",
						"FuzzyMatch select(mapColumn(",
						"          acctnum,",
						"          fullname,",
						"          phone,",
						"          zip,",
						"          SoundexValue",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> soundexBranch",
						"soundexJoin aggregate(groupBy(phone,",
						"          soundexBranch@SoundexValue),",
						"     phonematch = sum(1),",
						"          acctnum_agg = last(acctnum)) ~> groupPhone",
						"soundexJoin select(mapColumn(",
						"          soundexmatch,",
						"          acctnum,",
						"          fullname,",
						"          phone,",
						"          zip,",
						"          SoundexValue = soundexBranch@SoundexValue",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> phoneBranch",
						"groupPhone, phoneBranch join(acctnum_agg == acctnum,",
						"     joinType:'right',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> phoneJoin",
						"phoneJoin aggregate(groupBy(zip,",
						"          phoneBranch@SoundexValue),",
						"     zipcount = sum(1),",
						"          acctnum_agg = last(acctnum_agg)) ~> groupZip",
						"phoneJoin select(mapColumn(",
						"          phonematch,",
						"          soundexmatch,",
						"          acctnum,",
						"          fullname,",
						"          phone = phoneBranch@phone,",
						"          zip,",
						"          SoundexValue = phoneBranch@SoundexValue",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> zipBranch",
						"groupZip, zipBranch join(acctnum_agg == acctnum,",
						"     joinType:'right',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> zipJoin",
						"zipJoin derive(soundexweight = 50,",
						"          zipweight = 25,",
						"          phoneweight = 25,",
						"          soundexbool = iif (soundexmatch > 1, 1, 0),",
						"          zipbool = iif (zipcount > 1, 1, 0),",
						"          phonebool = iif (phonematch > 1, 1, 0)) ~> setConstants",
						"setConstants derive(matchscore = (soundexbool * 50) + (zipbool * 25) + (phonebool * 25)) ~> matchScore",
						"matchScore select(mapColumn(",
						"          phone,",
						"          acctnum,",
						"          fullname,",
						"          zip = zipBranch@zip,",
						"          matchscore",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> finalResult",
						"CreateFullName select(mapColumn(",
						"          phone = {Phone No. },",
						"          zip = Zip,",
						"          fullname,",
						"          acctnum = {Emp ID}",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> MapNames",
						"inputName derive(fullname = {First Name} + ' ' + {Last Name}) ~> CreateFullName",
						"finalResult split(matchscore > 50,",
						"     disjoint: false) ~> CheckForDupes@(Duplicates, NotDupe)",
						"CheckForDupes@Duplicates output(mapColumn(",
						"          phone,",
						"          acctnum,",
						"          fullname,",
						"          zip,",
						"          matchscore",
						"     )) ~> outputDupes",
						"CheckForDupes@NotDupe output() ~> outputNoDupes"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/dedupeFlowlet')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "Flowlet",
				"typeProperties": {
					"sources": [],
					"sinks": [],
					"transformations": [
						{
							"name": "FuzzyMatch"
						},
						{
							"name": "groupSoundex"
						},
						{
							"name": "Orig1"
						},
						{
							"name": "soundexJoin"
						},
						{
							"name": "soundexBranch"
						},
						{
							"name": "groupPhone"
						},
						{
							"name": "phoneBranch"
						},
						{
							"name": "phoneJoin"
						},
						{
							"name": "groupZip"
						},
						{
							"name": "zipBranch"
						},
						{
							"name": "zipJoin"
						},
						{
							"name": "setConstants"
						},
						{
							"name": "matchScore"
						},
						{
							"name": "finalResult"
						},
						{
							"name": "MapNames"
						},
						{
							"name": "CreateFullName"
						},
						{
							"name": "CheckForDupes"
						},
						{
							"name": "inputName"
						},
						{
							"name": "outputDupes"
						},
						{
							"name": "outputNoDupes"
						}
					],
					"scriptLines": [
						"input(output(",
						"          {Emp ID} as string,",
						"          {First Name} as string,",
						"          {Last Name} as string,",
						"          {Phone No. } as string,",
						"          County as string,",
						"          City as string,",
						"          State as string,",
						"          Zip as string",
						"     ),",
						"     order: 0,",
						"     allowSchemaDrift: true) ~> inputName",
						"MapNames derive(SoundexValue = soundex(fullname)) ~> FuzzyMatch",
						"Orig1 aggregate(groupBy(SoundexValue),",
						"     soundexmatch = sum(1)) ~> groupSoundex",
						"FuzzyMatch select(mapColumn(",
						"          acctnum,",
						"          fullname,",
						"          phone,",
						"          zip,",
						"          SoundexValue",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> Orig1",
						"groupSoundex, soundexBranch join(groupSoundex@SoundexValue == soundexBranch@SoundexValue,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> soundexJoin",
						"FuzzyMatch select(mapColumn(",
						"          acctnum,",
						"          fullname,",
						"          phone,",
						"          zip,",
						"          SoundexValue",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> soundexBranch",
						"soundexJoin aggregate(groupBy(phone,",
						"          soundexBranch@SoundexValue),",
						"     phonematch = sum(1),",
						"          acctnum_agg = last(acctnum)) ~> groupPhone",
						"soundexJoin select(mapColumn(",
						"          soundexmatch,",
						"          acctnum,",
						"          fullname,",
						"          phone,",
						"          zip,",
						"          SoundexValue = soundexBranch@SoundexValue",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> phoneBranch",
						"groupPhone, phoneBranch join(acctnum_agg == acctnum,",
						"     joinType:'right',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> phoneJoin",
						"phoneJoin aggregate(groupBy(zip,",
						"          phoneBranch@SoundexValue),",
						"     zipcount = sum(1),",
						"          acctnum_agg = last(acctnum_agg)) ~> groupZip",
						"phoneJoin select(mapColumn(",
						"          phonematch,",
						"          soundexmatch,",
						"          acctnum,",
						"          fullname,",
						"          phone = phoneBranch@phone,",
						"          zip,",
						"          SoundexValue = phoneBranch@SoundexValue",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> zipBranch",
						"groupZip, zipBranch join(acctnum_agg == acctnum,",
						"     joinType:'right',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> zipJoin",
						"zipJoin derive(soundexweight = 50,",
						"          zipweight = 25,",
						"          phoneweight = 25,",
						"          soundexbool = iif (soundexmatch > 1, 1, 0),",
						"          zipbool = iif (zipcount > 1, 1, 0),",
						"          phonebool = iif (phonematch > 1, 1, 0)) ~> setConstants",
						"setConstants derive(matchscore = (soundexbool * 50) + (zipbool * 25) + (phonebool * 25)) ~> matchScore",
						"matchScore select(mapColumn(",
						"          phone,",
						"          acctnum,",
						"          fullname,",
						"          zip = zipBranch@zip,",
						"          matchscore",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> finalResult",
						"CreateFullName select(mapColumn(",
						"          phone = {Phone No. },",
						"          zip = Zip,",
						"          fullname,",
						"          acctnum = {Emp ID}",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> MapNames",
						"inputName derive(fullname = {First Name} + ' ' + {Last Name}) ~> CreateFullName",
						"finalResult split(matchscore > 50,",
						"     disjoint: false) ~> CheckForDupes@(Duplicates, NotDupe)",
						"CheckForDupes@Duplicates output() ~> outputDupes",
						"CheckForDupes@NotDupe output() ~> outputNoDupes"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/flowlet1')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "Flowlet",
				"typeProperties": {
					"sources": [],
					"sinks": [],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "input1"
						},
						{
							"name": "output1"
						}
					],
					"scriptLines": [
						"input(output(",
						"          abc as integer",
						"     ),",
						"     order: 0,",
						"     allowSchemaDrift: true) ~> input1",
						"input1 derive(abc = abc * 2) ~> derivedColumn1",
						"derivedColumn1 output() ~> output1"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/flowlet2')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "Flowlet",
				"typeProperties": {
					"sources": [],
					"sinks": [],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "input1"
						},
						{
							"name": "output1"
						}
					],
					"scriptLines": [
						"input(output(",
						"          name as string",
						"     ),",
						"     order: 0,",
						"     allowSchemaDrift: true) ~> input1",
						"input1 derive(name = upper(name)) ~> derivedColumn1",
						"derivedColumn1 output(mapColumn(",
						"          name,",
						"          name2 = name",
						"     )) ~> output1"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/mydflibrary')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "UDFLibrary",
				"typeProperties": {
					"sources": [],
					"sinks": [],
					"transformations": [],
					"scriptLines": [
						"irr() as integer = 1+1"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/default')]",
			"type": "Microsoft.DataFactory/factories/managedVirtualNetworks",
			"apiVersion": "2018-06-01",
			"properties": {},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/AWCustAddress')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureSqlDatabase1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "CustomerID",
						"type": "int",
						"precision": 10
					},
					{
						"name": "AddressID",
						"type": "int",
						"precision": 10
					},
					{
						"name": "AddressType",
						"type": "nvarchar"
					},
					{
						"name": "rowguid",
						"type": "uniqueidentifier"
					},
					{
						"name": "ModifiedDate",
						"type": "datetime",
						"precision": 23,
						"scale": 3
					}
				],
				"typeProperties": {
					"schema": "SalesLT",
					"table": "CustomerAddress"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/AWCustomers')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureSqlDatabase1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "CustomerID",
						"type": "int",
						"precision": 10
					},
					{
						"name": "NameStyle",
						"type": "bit"
					},
					{
						"name": "Title",
						"type": "nvarchar"
					},
					{
						"name": "FirstName",
						"type": "nvarchar"
					},
					{
						"name": "MiddleName",
						"type": "nvarchar"
					},
					{
						"name": "LastName",
						"type": "nvarchar"
					},
					{
						"name": "Suffix",
						"type": "nvarchar"
					},
					{
						"name": "CompanyName",
						"type": "nvarchar"
					},
					{
						"name": "SalesPerson",
						"type": "nvarchar"
					},
					{
						"name": "EmailAddress",
						"type": "nvarchar"
					},
					{
						"name": "Phone",
						"type": "nvarchar"
					},
					{
						"name": "PasswordHash",
						"type": "varchar"
					},
					{
						"name": "PasswordSalt",
						"type": "varchar"
					},
					{
						"name": "rowguid",
						"type": "uniqueidentifier"
					},
					{
						"name": "ModifiedDate",
						"type": "datetime",
						"precision": 23,
						"scale": 3
					}
				],
				"typeProperties": {
					"schema": "SalesLT",
					"table": "Customer"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Address')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureSqlDatabase1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "AddressID",
						"type": "int",
						"precision": 10
					},
					{
						"name": "AddressLine1",
						"type": "nvarchar"
					},
					{
						"name": "AddressLine2",
						"type": "nvarchar"
					},
					{
						"name": "City",
						"type": "nvarchar"
					},
					{
						"name": "StateProvince",
						"type": "nvarchar"
					},
					{
						"name": "CountryRegion",
						"type": "nvarchar"
					},
					{
						"name": "PostalCode",
						"type": "nvarchar"
					},
					{
						"name": "rowguid",
						"type": "uniqueidentifier"
					},
					{
						"name": "ModifiedDate",
						"type": "datetime",
						"precision": 23,
						"scale": 3
					}
				],
				"typeProperties": {
					"schema": "SalesLT",
					"table": "Address"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Avro1')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureBlobStorage1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "Avro",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"folderPath": "output/avro",
						"container": "mycontainer"
					}
				},
				"schema": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/AzureDataExplorerTable1')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureDataExplorer1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "AzureDataExplorerTable",
				"schema": [
					{
						"name": "medallion",
						"type": "guid"
					},
					{
						"name": "hack_license",
						"type": "guid"
					},
					{
						"name": "vendor_id",
						"type": "string"
					},
					{
						"name": "rate_code",
						"type": "long"
					},
					{
						"name": "store_and_fwd_flag",
						"type": "string"
					},
					{
						"name": "pickup_datetime",
						"type": "datetime"
					},
					{
						"name": "dropoff_datetime",
						"type": "datetime"
					},
					{
						"name": "passenger_count",
						"type": "long"
					},
					{
						"name": "trip_time_in_secs",
						"type": "long"
					},
					{
						"name": "trip_distance",
						"type": "real"
					},
					{
						"name": "pickup_longitude",
						"type": "real"
					},
					{
						"name": "pickup_latitude",
						"type": "real"
					},
					{
						"name": "dropoff_longitude",
						"type": "real"
					},
					{
						"name": "dropoff_latitude",
						"type": "real"
					}
				],
				"typeProperties": {
					"table": "marktable"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/AzureDataExplorerTable2')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureDataExplorer1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "AzureDataExplorerTable",
				"schema": [],
				"typeProperties": {
					"table": "aggtable"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/AzureSqlDatabaseDataSource')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "Connection to your source data store.",
				"linkedServiceName": {
					"referenceName": "SQLMovies",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {
					"schema": "dbo",
					"table": "DataSourceTable"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/AzureSqlDatabaseDataSource1')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "Connection to your source data store.",
				"linkedServiceName": {
					"referenceName": "AzureSqlDatabase1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {
					"schema": "dbo",
					"table": "DataSourceTable"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/AzureSqlDatabaseDataSource2')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "Connection to your source data store.",
				"linkedServiceName": {
					"referenceName": "AzureSqlDatabase1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {
					"schema": "dbo",
					"table": "DataSourceTable"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/AzureSqlDatabaseExternal_ControlTable')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "External control table to store high water mark value.",
				"linkedServiceName": {
					"referenceName": "AzureSqlDatabase1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {
					"schema": "dbo",
					"table": "watermarktable"
				}
			},
			"dependsOn": []
		}
	]
}